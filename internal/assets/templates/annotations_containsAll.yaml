variables:
- name: objectAnnotations
  expression: 'has(object.metadata.annotations) ? object.metadata.annotations : []'
- name: templateAnnotations
  expression: 'has(object.spec.template.metadata.annotations) ? object.spec.template.metadata.annotations : []'
- name: jobTemplateAnnotations
  expression: 'has(object.spec.jobTemplate.metadata.annotations) ? object.spec.jobTemplate.metadata.annotations : []'
- name: isPod
  expression: 'object.kind == "Pod"'
- name: isController
  expression: 'object.kind in ["Deployment", "ReplicaSet", "DaemonSet", "StatefulSet", "Job"]'
- name: isCronJob
  expression: 'object.kind == "CronJob"'
- name: objectAnnotationsMatch
  expression: 'variables.userConfig.all(key, key in variables.objectAnnotations && variables.objectAnnotations[key].matches(variables.userConfig[key]))'
- name: templateAnnotationsMatch
  expression: 'variables.userConfig.all(key, key in variables.templateAnnotations && variables.templateAnnotations[key].matches(variables.userConfig[key]))'
- name: jobTemplateAnnotationsMatch
  expression: 'variables.userConfig.all(key, key in variables.jobTemplateAnnotations && variables.jobTemplateAnnotations[key].matches(variables.userConfig[key]))'
validations:
- expression: |
    !(variables.isPod) || 
    !(variables.objectAnnotationsMatch)
  message: 'operator: contains_all, annotations cannot use all userConfig key/value'
- expression: |
    !(variables.isController) ||
    (!(variables.objectAnnotationsMatch) && !(variables.templateAnnotationsMatch))
  message: 'operator: contains_all, annotations cannot use all userConfig key/value'
- expression: |
    !(variables.isCronJob) ||
    (!(variables.objectAnnotationsMatch) && !(variables.jobTemplateAnnotationsMatch))
  message: 'operator: contains_all, annotations cannot use all userConfig key/value'
