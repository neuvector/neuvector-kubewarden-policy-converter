variables:
- name: objectLabels
  expression: 'has(object.metadata.labels) ? object.metadata.labels : []'
- name: templateLabels
  expression: 'has(object.spec.template.metadata.labels) ? object.spec.template.metadata.labels : []'
- name: jobTemplateLabels
  expression: 'has(object.spec.jobTemplate.metadata.labels) ? object.spec.jobTemplate.metadata.labels : []'
- name: isPod
  expression: 'object.kind == "Pod"'
- name: isController
  expression: 'object.kind in ["Deployment", "ReplicaSet", "DaemonSet", "StatefulSet", "Job"]'
- name: isCronJob
  expression: 'object.kind == "CronJob"'
- name: objectLabelsMatch
  expression: 'variables.userConfig.all(key, key in variables.objectLabels && variables.objectLabels[key].matches(variables.userConfig[key]))'
- name: templateLabelsMatch
  expression: 'variables.userConfig.all(key, key in variables.templateLabels && variables.templateLabels[key].matches(variables.userConfig[key]))'
- name: jobTemplateLabelsMatch
  expression: 'variables.userConfig.all(key, key in variables.jobTemplateLabels && variables.jobTemplateLabels[key].matches(variables.userConfig[key]))'
validations:
- expression: |
    !(variables.isPod) || 
    !(variables.objectLabelsMatch)
  message: 'operator: contains_all, labels cannot use all userConfig key/value'
- expression: |
    !(variables.isController) ||
    (!(variables.objectLabelsMatch) && !(variables.templateLabelsMatch))
  message: 'operator: contains_all, labels cannot use all userConfig key/value'
- expression: |
    !(variables.isCronJob) ||
    (!(variables.objectLabelsMatch) && !(variables.jobTemplateLabelsMatch))
  message: 'operator: contains_all, labels cannot use all userConfig key/value'
